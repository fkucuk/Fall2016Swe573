<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="tr">

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>FatApp</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- Latest compiled and minified CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<!-- Latest compiled JavaScript -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

	<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

	<!--<script src="js\lib\jquery-3.1.1.min.js"></script>-->
</head>

<body>
	<div class="container-fluid">
		<div class="row">
			<nav class="navbar navbar-default">
				<div class="container-fluid">
					<div class="navbar-header">
						<a class="navbar-brand" href="index.html">FatApp</a>
					</div>
					<ul class="nav navbar-nav">
						<li><a href="index.html">Home</a></li>
						<li><a href="report.html">My Stats</a></li>
						<li class="active"><a href="#">My Account</a></li>
					</ul>



				</div>
			</nav>
		</div>
	</div>
	<div class="container content">

		<div class="row" style="">
			<div class="col-md-12">
				<h1>Hello <span id="name-header"> Name </span></h1></div>
			<div class="col-sm-12 col-md-6 account-wrap">
				<h3>Your Account</h3>
				<p class="field"><strong>	Name:    </strong><span class="user-info" id="name"> Name Name</span></p>
				<p class="field"><strong> E-Mail:  </strong><span class="user-info" id="email"> mail@mail.com </span></p>
				<p class="field"><strong> Weight:  </strong><span class="user-info" id="weight"> 90 </span><span id="unit-weight">kg</span></p>
				<p class="field"><strong> Height:  </strong><span class="user-info" id="height"> 180 </span><span id="unit-height">cm</span></p>
				<button class="btn btn-primary" id="updateInfo"> Update Account Info</button>
			</div>
			<div class="col-md-5 col-md-offset-1 col-sm-12 bmi">
				<h3>Your <a target="_blank" href="https://simple.wikipedia.org/wiki/Body_mass_index">BMI</a></h3>
				<hr/>
				<h1 id="bmi">22.8732</h1>
				<hr/>
				<span>You are considered as </span><span id="bmi-desc">"obese"</span>
			</div>
		</div>

	</div>

</body>
<link rel="stylesheet" href="css\style.css" />
<link rel="stylesheet" href="js\lib\bootstrap-notify-3.1.3/animate.css">
<script src="js\lib\bootstrap-notify-3.1.3/bootstrap-notify.min.js"></script>
<script>
	$('.user-info').attr('contenteditable', 'true');
	$_user = {};
	var initialLoadURL = "dummyUserInfo.json"

	function loadInfo(url, callBack) {
		$.ajax({
			type: "GET",
			url: url,
			success: function(res) {
				$_user = res;
					$('#name-header').text(res.name);
				$('#name').text(res.name);
				$('#email').text(res.email);
				$('#weight').text(res.weight);
				$('#height').text(res.height);
				getBMI(res.userId);
				if(callBack){callBack();}
			},
			error: function(res) {
				$.notify({
					message: 'Who are you?'
				}, {
					type: 'danger'
				});
			}
		});
	}

	function getBMI(userId) {
		$.ajax({
			type: "GET",
			url: "/webapi/users/" + userId + "/bmi",
			success: function(res) {
				$('#bmi').text(res.value);
				$('#bmi-desc').text('"' + res.desc + '"');

			},
			error: function(res) {
				$.notify({
					message: 'You have no BMI.'
				}, {
					type: 'warning'
				});
			}
		});
	}

	loadInfo(initialLoadURL);

	$('#updateInfo').click(sendUpdatedInfo);

	function sendUpdatedInfo() {
		if($_user){
		$data = $_user;
		$data.email = $('#email').text();
		$data.name = $('#name').text();
		$data.weight = $('#weight').text();
		$data.height = $('#height').text();

		$.ajax({
			type: "GET",
			data: $data,
			url: "/webapi/users/" + $_user.userId + "/",
			success: function(res) {
					loadInfo("/webapi/users/"+ $_user.userId + "/", function(){
						$.notify({
							message: 'Account info is updated.'
						});
					});
			},
			error: function(res) {
				$.notify({
					message: 'Could not update account info'
				}, {
					type: 'warning'
				});
			}
		});
}	}
</script>

</html>
